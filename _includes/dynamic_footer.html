<div class="dynamic-footer">
    <div class="progress-bar-container">
        <div class="progress-bar"></div>
    </div>
    <div class="dynamic-footer-content">
        <div class="minimized-view">
            <h2>Get in touch</h2>
            <div class="scroll-hint">
                <span class="scroll-text">Scroll to expand</span>
                <div class="scroll-icon">â†“</div>
            </div>
        </div>
        <div class="expanded-view">
            <div class="contact-main">
                <h2>Get in touch</h2>
                <a href="mailto:{{ site.author.email }}" class="email-link">{{ site.author.email }}</a>
            </div>
            <div class="contact-details">
                <p>I'm always looking for new and exciting projects and people to work with.</p>
                <p>If you have an idea that you want to discuss, reach out to me!</p>

                <div class="social-links">
                    {% if site.author.github %}
                    <a href="https://github.com/{{ site.author.github }}" target="_blank" rel="noopener noreferrer">
                        GitHub
                    </a>
                    {% endif %}
                    {% if site.author.linkedin %}
                    <a href="https://linkedin.com/in/{{ site.author.linkedin }}" target="_blank"
                        rel="noopener noreferrer">
                        LinkedIn
                    </a>
                    {% endif %}
                    {% if site.author.twitter %}
                    <a href="https://twitter.com/{{ site.author.twitter }}" target="_blank" rel="noopener noreferrer">
                        Twitter
                    </a>
                    {% endif %}
                </div>

                <div class="footer-bottom">
                    <span>{{ site.time | date: "%Y" }} &copy; {{ site.author.name }}</span>
                    <a href="{{ '/about' | relative_url }}" class="about-link-footer">About Me</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const footer = document.querySelector('.dynamic-footer');
        const progressBar = document.querySelector('.progress-bar');
        let progress = 0;
        let isExpanded = false;
        const THRESHOLD = 500; // Total scroll delta needed to expand
        const DECAY = 5; // How fast progress decays when not scrolling

        // Ensure initial height is set correctly
        footer.style.height = '50px';

        // Wheel event handler
        window.addEventListener('wheel', (e) => {
            // Check if we are at the bottom of the page (with a small buffer)
            const scrollBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 5;

            if (!isExpanded) {
                if (scrollBottom && e.deltaY > 0) {
                    // At bottom and scrolling down -> Lock scroll and fill progress
                    e.preventDefault();

                    progress = Math.min(progress + e.deltaY, THRESHOLD);

                    if (progress >= THRESHOLD) {
                        expandFooter();
                    }
                }
                } else {
                // Expanded logic
                if (e.deltaY < 0) {
                    // Scrolling up -> Collapse immediately
                    collapseFooter();
                    progress = 0;
                }
            }

            updateUI();
        }, { passive: false });

        function expandFooter() {
            isExpanded = true;
            footer.classList.add('is-expanded');
            footer.style.height = ''; // Remove inline height to let CSS take over (90vh)

            // Auto-scroll to the bottom to reveal content
            setTimeout(() => {
                footer.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }, 100);
        }

        function collapseFooter() {
            isExpanded = false;
            footer.classList.remove('is-expanded');
            footer.style.height = '50px'; // Force back to 50px
        }

        function updateUI() {
            const percentage = (progress / THRESHOLD) * 100;
            progressBar.style.width = `${percentage}%`;
            progressBar.style.opacity = percentage > 0 ? 1 : 0;
        }

        // Decay progress if user stops scrolling before threshold
        setInterval(() => {
            if (!isExpanded && progress > 0) {
                progress = Math.max(0, progress - DECAY);
                updateUI();
            }
        }, 16);
    });
</script>